---
title: "Seminar Work - Data Analysis"
author: "Antoine Thomas"
date: "`r Sys.Date()`"
output: github_document
bibliography: literatur.bib
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r library import, message=FALSE, warning=FALSE, include=FALSE}
library(tidyverse)
library(lubridate)
library(xtable)
library(knitr)
```

## Data Analysis

### Hotel room rates

First, the scraped datasets with price information for selected hotels are imported. Then, the data records for all hotels are filtered so that they only contain price information for simple double bedrooms. In addition, care is taken to ensure that there is a maximum of one entry for each hotel each day. Thereby, the cheapest option is always chosen. This is primarily due to the fact that more expensive prices usually include various additional services, such as free cancellation up to the day of the start of the stay or meals such as breakfast. Thus, it can be assured that all prices cover a comparable range of services, regardless of the hotel. 
Subsequently, all data of the respective hotels are combined into one large data set.


```{r hotel price list import, echo=TRUE, message=FALSE, warning=FALSE}
# Data import
hotel_bb <- read_csv2(file = "B&B_Hotel_München-Hbf.csv")

# Filter for double bedrooms and keep the cheapest possible price per day
hotel_bb_clean <- hotel_bb %>%
  filter(room == "Doppelzimmer") %>%
  group_by(date, room) %>%
  slice(which.min(price))

# Further import process hidden........
```

```{r hidden hotel price list import, message=FALSE, warning=FALSE, include=FALSE}
# Data import
hotel_bold <- read_csv2(file = "Bold_Hotel_München.csv")
hotel_brunnenhof <- read_csv2(file = "Brunnenhof_City_Center.csv")
hotel_centro_mondial <- read_csv2(file = "Centro_Hotel_Mondial.csv")
hotel_demas <- read_csv2(file = "Hotel_Demas_München.csv")
hotel_gio <- read_csv2(file = "Hotel_GIO.csv")
hotel_mirabell <- read_csv2(file = "Hotel_Mirabell.csv")
hotel_city_center <- read_csv2(file = "Hotel_München_City_Center.csv")
hotel_munchen_city <- read_csv2(file = "Hotel_Munich_City.csv")
hotel_relexa <- read_csv2(file = "relexa_hotel_München.csv")

# Filter for double bedrooms and keep the cheapest possible price per day
hotel_bb_clean <- hotel_bb %>%
  filter(room == "Doppelzimmer") %>%
  group_by(date, room) %>%
  slice(which.min(price))

hotel_bold_clean <- hotel_bold %>%
  filter(room == "Bold Doppelzimmer") %>%
  group_by(date, room) %>%
  slice(which.min(price))

hotel_brunnenhof_clean <- hotel_brunnenhof %>%
  filter(room == "Doppelzimmer") %>%
  group_by(date, room) %>%
  slice(which.min(price))

hotel_centro_mondial_clean <- hotel_centro_mondial %>%
  filter(room == "Standard Doppelzimmer") %>%
  group_by(date, room) %>%
  slice(which.min(price))

hotel_demas_clean <- hotel_demas %>%
  filter(room == "Standard Doppelzimmer") %>%
  group_by(date, room) %>%
  slice(which.min(price))

hotel_gio_clean <- hotel_gio %>%
  filter(room == "Doppelzimmer") %>%
  group_by(date, room) %>%
  slice(which.min(price))

hotel_mirabell_clean <- hotel_mirabell %>%
  filter(room == "Superior Zimmer") %>%
  group_by(date, room) %>%
  slice(which.min(price))

hotel_city_center_clean <- hotel_city_center %>%
  filter(room == "Standard Zimmer") %>%
  group_by(date, room) %>%
  slice(which.min(price))

hotel_munchen_city_clean <- hotel_munchen_city %>%
  filter(room == "Doppel- oder Zweibettzimmer") %>%
  group_by(date, room) %>%
  slice(which.min(price))

hotel_relexa_clean <- hotel_relexa %>%
  filter(room == "Comfort Doppelzimmer") %>%
  group_by(date, room) %>%
  slice(which.min(price))

# Remove raw datas
remove(hotel_bb, 
       hotel_bold, 
       hotel_brunnenhof, 
       hotel_centro_mondial, 
       hotel_demas, 
       hotel_gio, 
       hotel_mirabell, 
       hotel_city_center, 
       hotel_munchen_city, 
       hotel_relexa)
```

```{r merging all datasets, echo=TRUE, message=FALSE, warning=FALSE}
# binding data of all hotels
hotel_data <- rbind(hotel_bb_clean,
        hotel_bold_clean,
        hotel_brunnenhof_clean,
        hotel_centro_mondial_clean,
        hotel_city_center_clean,
        hotel_demas_clean,
        hotel_gio_clean,
        hotel_mirabell_clean,
        hotel_munchen_city_clean,
        hotel_relexa_clean)
```

In the dataset `hotel_data` the high demand phase, the Oktoberfest, must now be noted. The 2023 event takes place from 16.09.2023 to 03.10.2023.
To do this, the function `checkOktoberfest` is created, which is given a date as parameter, and checks if this date is within period of the Oktoberfest.
After that a new attribute `oktoberfest` is created in `hotel_data`, which indicates with the help of the mentioned function, whether the Oktoberfest takes place on a specific day or not.

```{r add oktoberfest attribute, echo=TRUE, message=FALSE, warning=FALSE}
checkOktoberfest <- function(roomDate) {
  oktoberfestDateInterval = interval(ymd("2023-09-16"), ymd("2023-10-03"))
  roomDate %within% oktoberfestDateInterval
}

hotel_data <- hotel_data  %>%
  mutate(oktoberfest = unlist(map(.x = date, .f = checkOktoberfest)))
```

#### Price over time

In the following figures, the temporal price progression over the period from April 10, 2023 to December 31, 2023 is illustrated for the selected hotels. Vertical lines have been included on these to indicate the start and end of the Oktoberfest period. From these figures, it can be seen that all hotels retrieve the highest average prices of the year during the Oktoberfest period. Although there are clearly similar fluctuations in the pricing of hotel rooms at other times of the year, these cannot be compared with the extent of the Oktoberfest.

```{r price over time plots, echo=FALSE}
hotel_data %>%
  group_by(date) %>%
  summarise(price = mean(price)) %>%
  ggplot(aes(x = date, y = price)) +
  geom_line() +
  geom_vline(xintercept = date("2023-09-16"), colour = "red", alpha =.3) +
  geom_vline(xintercept = date("2023-10-03"), colour = "red", alpha = .3) +
  theme_bw() +
  labs(x = "Date", y = "Room Rate", title = "Average price over time for a double bedroom in a hotel in the center of Munich") +
  theme(plot.title = element_text(face = "bold", size = "11"))
  
hotel_data %>%
  ggplot(aes(x = date, y = price)) +
  geom_line() +
  geom_vline(xintercept = date("2023-09-16"), colour = "red", alpha =.3) +
  geom_vline(xintercept = date("2023-10-03"), colour = "red", alpha = .3) +
  facet_wrap(~name) +
  theme_bw() +
  labs(x = "Date",y = "Room Rate", title = "Price over time for a double bedroom in 10 similar hotels in the center of Munich") +
  theme(plot.title = element_text(face = "bold",size = "11"))
```

To enable a separated analysis of the two time periods, the data sets `hotel_data_oktoberfest` and `hotel_data_no_oktoberfest` were created by filtering in `hotel_data` for the attribute `oktoberfest` which was created previously.

```{r split hotel_data, echo=TRUE, message=FALSE, warning=FALSE}
# Filtering room rates during the time of the Oktoberfest
hotel_data_oktoberfest <- filter(hotel_data, oktoberfest == TRUE)
# Filtering room rates during times not related to the Oktoberfest
hotel_data_no_oktoberfest <- filter(hotel_data, oktoberfest == FALSE)
```

In the figures above showing the price trend, one could clearly recognize that even in periods unrelated to the Oktoberfest, above-average prices can occur in very short periods.
A boxplot diagram clearly depicts this characteristic through observable outliers. Thereby these disperse from approximately 240 to 580 euros. These outliers represent about *12.5%* of the observations.
An initial assumption that these prices are called up on weekends in order to profit from weekend tourism was investigated in more detail. For this purpose, all outliers in the dataset `hotel_data_no_oktoberfest` were filtered. Then, the respective day of the week was added to each observation. However, in the following diagram, which shows the number of outliers per day of the week, no higher price tendency can be observed on weekends. Since these outliers could not be linked to any other clear event or cause, it was decided to exclude them from the data set and to disregard them in the context of the further analysis.

```{r boxplot prices no oktoberfest, echo=FALSE, message=FALSE, warning=FALSE}
# Boxplot visualizing all the price distribution during times not related to the Oktoberfest
hotel_data_no_oktoberfest %>%
  ggplot(aes(x = price)) +
  geom_boxplot(outlier.alpha = .5) +
  theme_bw() +
  theme(axis.title.y=element_blank(),
        axis.text.y=element_blank(),
        axis.ticks.y=element_blank(),
        plot.title = element_text(face = "bold")) +
  theme_bw() +
  labs(x = "Room rate", title = "Room rate distribution in times not related to the Oktoberfest 2023") +
  theme(plot.title = element_text(face = "bold"))

# Diagram visualizing the amount of outliers per day of the week during times not related to the Oktoberfest
hotel_data_no_oktoberfest %>%
  filter(price > quantile(hotel_data_no_oktoberfest$price, .875)) %>%
  mutate(weekday = wday(date, label = TRUE)) %>%
  group_by(weekday) %>%
  summarise(amount = n()) %>%
  ggplot(aes(x = weekday, y = amount)) +
  geom_col() +
  theme_bw() +
  labs(x = "Weekday", y = "Amount of observations", title = "Amount of outliers per weekday during times not related to the Oktoberfest 2023") +
  theme(plot.title = element_text(face = "bold", size = "12"))
```

After the outliers (12.5% highest price-related observations) in the time period other than the Oktoberfest were removed from the data set, adjusted average values could be determined.
In 2023, according to our dataset, the average price of a single double room in a mid-range hotel during Oktoberfest is around €402. Over the rest of the year, a room costs about 124€ per night.

```{r average daily rate during both periods, echo=TRUE, message=FALSE, warning=FALSE}
hotel_data_no_oktoberfest %>%
  filter(price < quantile(hotel_data_no_oktoberfest$price, .875)) %>%
  rbind(hotel_data_oktoberfest) %>%
  group_by(oktoberfest) %>%
  summarise(avg_price = mean(price)) %>%
  kable()
```

When looking at the the individual hotels, the average room rates in both phases as well as their relative difference were calculated for each of them. An average relative price increase of around 320% can be determined for the Oktoberfest period in comparison to normal demand phases. Here, however, the hotels tend to considerably differ from each other. The smallest price difference between both phases is 283% in our hotel sample, while the highest is 389%. The standard deviation is around 32%.

```{r average daily rates for each hotel, echo = TRUE, message= FALSE, warning= FALSE, tidy = TRUE}
# Average room rate during normal demand phases for each hotel
avg_room_rates_no_event <- hotel_data_no_oktoberfest %>%
  filter(price < quantile(hotel_data_no_oktoberfest$price, .875)) %>%
  group_by(name) %>%
  summarise(room_rate_no_event = mean(price))

# Average room rate during high demand phases for each hotel
avg_room_rates_oktoberfest <- hotel_data_oktoberfest %>%
  group_by(name) %>%
  summarise(room_rate_oktoberfest = mean(price))

# Binding of both data sets and computing the relative difference in price between both demand phases
avg_room_rates_no_event %>%
  left_join(avg_room_rates_oktoberfest, by = "name") %>%
  mutate(rel_diff = room_rate_oktoberfest/room_rate_no_event) %>%
  arrange(rel_diff) %>%
  kable()

# Summary of rel_diff values
avg_room_rates_no_event %>%
  left_join(avg_room_rates_oktoberfest, by = "name") %>%
  mutate(rel_diff = room_rate_oktoberfest/room_rate_no_event) %>%
  arrange(rel_diff) %>%
  pull(rel_diff) %>%
  summary()

# Standard deviation of rel_diff
avg_room_rates_no_event %>%
  left_join(avg_room_rates_oktoberfest, by = "name") %>%
  mutate(rel_diff = room_rate_oktoberfest/room_rate_no_event) %>%
  arrange(rel_diff) %>%
  pull(rel_diff) %>%
  sd() %>%
  kable(col.names = "Standard deviation")
```


### Hotel market performance in Munich

To obtain general data on the performance of hotels in Munich, the report on the hotel market from 2019 was used as part of the analysis. Due to the unusual situation in 2020 and 2021 caused by the Covid pandemic, a possible use of more recent data had to be examined. In 2020, prices on the Munich hotel market had dropped by an average of 22.8%, according to the Munich Hotel Market Report. "The massive drop in prices is also related to the cancellation of the Munich Oktoberfest as well as other events and the absence of demand by international guests" [@colliers2]. Although the situation improved a bit according to the following year's report [@colliers3], numerous events, including the Oktoberfest, did not take place that year either.
Since the event did not take place in these two years and the Munich hotel industry was in an exceptional situation, the use of data from 2020 and 2021 does not make sense in our analysis.



